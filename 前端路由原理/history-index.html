<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History SPA Example</title>
</head>

<body>
    <div id="ELEMENT">Home</div>
    <button onclick="router.push('/about')">Go to About</button>
    <button onclick="router.push('/contact')">Go to Contact</button>
    <button onclick="router.replace('/help')">Replace with Help</button>
    <button onclick="router.go(-1)">Go Back</button>
    <button onclick="router.go(1)">Go Forward</button>
</body>

<script type="module">
    export class BaseRouter {
        constructor(list) {
            this.list = list;
        }
        render(state) {
            let e = this.list.find(e => e.path === state);
            e = e ? e : this.list.find(e => e.path === '*');
            ELEMENT.innerText = e.component;
        }
    }

    export class HistoryRouter extends BaseRouter {
        constructor(list) {
            super(list);
            this.handler();
            // 监听 popstate事件
            window.addEventListener('popstate', e => {
                this.handler();
            });
        }
        // 渲染事件
        handler() {
            this.render(this.getState());
        }
        getState() {
            const path = window.location.pathname;
            return path ? path : '/';
        }
        push(path) {
            history.pushState(null, null, path);  // 向历史记录添加一个新条目
            this.handler();  // 更新视图
        }
        replace(path) {
            history.replaceState(null, null, path);  // 替换当前的历史记录条目
            this.handler();
        }
        go(n) {
            window.history.go(n);
        }
    }

    const router = new HistoryRouter([
        { path: '/', component: 'Home' },
        { path: '/about', component: 'About' },
        { path: '/contact', component: 'Contact' },
        { path: '/help', component: 'Help' },
        { path: '*', component: '404 Not Found' }
    ]);

    window.router = router; 
</script>

</html>